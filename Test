import os
import time
import cv2

def menu():
    print("---- Menu ----")
    print("1. Mở lần lượt hình ảnh trong một thư mục, đánh dấu vùng kích thước cố định")
    print("2. Tùy chọn 2")
    print("3. Tùy chọn 3")
    print("4. Thoát")

def option_1():
    folder_path = input("Nhập đường dẫn thư mục chứa hình ảnh: ")

    if not os.path.exists(folder_path):
        print("Thư mục không tồn tại!")
        return

    # Yêu cầu người dùng nhập tọa độ bắt đầu và kích thước vùng
    x = int(input("Nhập tọa độ X của góc trên bên trái vùng đánh dấu: "))
    y = int(input("Nhập tọa độ Y của góc trên bên trái vùng đánh dấu: "))
    width = int(input("Nhập chiều rộng của vùng đánh dấu: "))
    height = int(input("Nhập chiều cao của vùng đánh dấu: "))

    # Khởi tạo danh sách các tệp đã mở
    displayed_images = set()

    while True:
        # Lấy danh sách tất cả các tệp trong thư mục
        image_files = [f for f in os.listdir(folder_path) if f.endswith(('.png', '.jpg', '.jpeg'))]
        
        # Lọc ra những tệp chưa được hiển thị
        new_images = [f for f in image_files if f not in displayed_images]

        if new_images:
            for image_file in new_images:
                image_path = os.path.join(folder_path, image_file)
                
                # Sử dụng OpenCV để mở hình ảnh
                img = cv2.imread(image_path)
                
                # Vẽ một hình chữ nhật với kích thước xác định
                cv2.rectangle(img, (x, y), (x + width, y + height), (0, 255, 0), 2)  # Màu xanh lá, độ dày 2

                cv2.imshow('Image Viewer', img)  # Hiển thị hình ảnh trong cửa sổ 'Image Viewer'
                
                # Thêm tệp vào danh sách các tệp đã hiển thị
                displayed_images.add(image_file)

                # Đợi 3 giây
                cv2.waitKey(3000)  # Đợi trong 3000 ms (3 giây)

        else:
            print("Không có hình ảnh mới. Đang tiếp tục theo dõi...")

        # Đợi 5 giây trước khi kiểm tra thư mục lại để tìm hình ảnh mới
        time.sleep(5)

        # Nếu bạn muốn cho phép người dùng thoát bằng cách nhấn phím
        if cv2.waitKey(1) & 0xFF == ord('q'):
            print("Thoát chương trình theo yêu cầu của người dùng.")
            break

    # Đóng tất cả các cửa sổ khi kết thúc
    cv2.destroyAllWindows()

def option_2():
    print("Bạn đã chọn Tùy chọn 2")

def option_3():
    print("Bạn đã chọn Tùy chọn 3")

def main():
    while True:
        menu()
        choice = input("Chọn một tùy chọn: ")

        if choice == "1":
            option_1()
        elif choice == "2":
            option_2()
        elif choice == "3":
            option_3()
        elif choice == "4":
            print("Thoát chương trình")
            break
        else:
            print("Lựa chọn không hợp lệ. Vui lòng chọn lại.")

if __name__ == "__main__":
    main()
